<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown æ–‡ç« æŸ¥çœ‹å™¨ | å¸¦ç€æ³¥åœŸçš„åšåšå®¢</title>
    <link rel="stylesheet" href="./styles/main.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <style>
        .markdown-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .markdown-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .file-selector {
            margin-bottom: 20px;
            text-align: center;
        }
        .file-input {
            padding: 10px;
            border: 2px dashed #ddd;
            border-radius: 5px;
            cursor: pointer;
            background: #f9f9f9;
        }
        .file-input:hover {
            border-color: #007bff;
            background: #f0f8ff;
        }
        .article-list {
            margin: 20px 0;
        }
        .article-item {
            padding: 10px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .article-item:hover {
            background: #e9ecef;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        /* ä»£ç å—æ ·å¼ä¼˜åŒ– */
        .markdown-content pre {
            background: #2d3748 !important;
            color: #e2e8f0 !important;
            padding: 1.5rem !important;
            border-radius: 8px !important;
            overflow-x: auto !important;
            margin: 1.5rem 0 !important;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', 'Source Code Pro', monospace !important;
            font-size: 14px !important;
            line-height: 1.5 !important;
            font-weight: 400 !important;
            text-rendering: optimizeLegibility !important;
            -webkit-font-smoothing: antialiased !important;
            -moz-osx-font-smoothing: grayscale !important;
        }
        
        .markdown-content code {
            background: #f1f5f9 !important;
            color: #e11d48 !important;
            padding: 0.2rem 0.4rem !important;
            border-radius: 4px !important;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', 'Source Code Pro', monospace !important;
            font-size: 0.9em !important;
            font-weight: 400 !important;
            text-rendering: optimizeLegibility !important;
            -webkit-font-smoothing: antialiased !important;
            -moz-osx-font-smoothing: grayscale !important;
        }
        
        .markdown-content pre code {
            background: transparent !important;
            color: inherit !important;
            padding: 0 !important;
        }
    </style>
</head>
<body>
    <div class="main">
        <!-- ä¾§è¾¹æ  -->
        <div class="sidebar">
            <div class="top-container">
                <div class="top-header-container">
                    <a class="site-title-container" href="/">
                        <img src="./images/avatar.png?v=1659011765580" class="site-logo">
                        <h1 class="site-title">å¸¦ç€æ³¥åœŸçš„åšåšå®¢</h1>
                    </a>
                </div>
                <div>
                    <a href="/" class="site-nav">é¦–é¡µ</a>
                    <a href="/archives" class="site-nav">å½’æ¡£</a>
                    <a href="/tags" class="site-nav">æ ‡ç­¾</a>
                    <a href="/post/about" class="site-nav">å…³äº</a>
                </div>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-container">
            <div class="content-container">
                <div class="markdown-container">
                    <h1>ğŸ“ Markdown æ–‡ç« æŸ¥çœ‹å™¨</h1>
                    
                    <!-- æ–‡ä»¶é€‰æ‹©å™¨ -->
                    <div class="file-selector">
                        <div class="file-input" onclick="document.getElementById('fileInput').click()">
                            <p>ğŸ“ ç‚¹å‡»é€‰æ‹© Markdown æ–‡ä»¶</p>
                            <p style="font-size: 14px; color: #666;">æ”¯æŒ .md å’Œ .markdown æ–‡ä»¶</p>
                        </div>
                        <input type="file" id="fileInput" accept=".md,.markdown" style="display: none;">
                    </div>

                    <!-- æ–‡ç« åˆ—è¡¨ -->
                    <div class="article-list" id="articleList" style="display: none;">
                        <h3>ğŸ“š æœ€è¿‘æŸ¥çœ‹çš„æ–‡ç« </h3>
                        <div id="recentArticles"></div>
                    </div>

                    <!-- åŠ è½½çŠ¶æ€ -->
                    <div class="loading" id="loading" style="display: none;">
                        <p>ğŸ”„ æ­£åœ¨åŠ è½½æ–‡ç« ...</p>
                    </div>

                    <!-- Markdown å†…å®¹ -->
                    <div class="markdown-content" id="markdownContent" style="display: none;">
                        <div id="articleTitle"></div>
                        <div id="articleMeta"></div>
                        <div id="articleBody"></div>
                    </div>

                    <!-- ä½¿ç”¨è¯´æ˜ -->
                    <div id="instructions">
                        <h3>ğŸš€ ä½¿ç”¨æ–¹æ³•</h3>
                        <ol>
                            <li><strong>é€‰æ‹©æ–‡ä»¶</strong>ï¼šç‚¹å‡»ä¸Šæ–¹åŒºåŸŸé€‰æ‹©æ‚¨çš„ Markdown æ–‡ä»¶</li>
                            <li><strong>è‡ªåŠ¨æ¸²æŸ“</strong>ï¼šæ–‡ä»¶ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºç¾è§‚çš„ç½‘é¡µæ ¼å¼</li>
                            <li><strong>ä¿å­˜æ–‡ç« </strong>ï¼šå¦‚æœæ»¡æ„ï¼Œå¯ä»¥ç‚¹å‡»"ä¿å­˜ä¸ºåšå®¢æ–‡ç« "æŒ‰é’®</li>
                        </ol>
                        
                        <h3>âœ¨ ç‰¹æ€§</h3>
                        <ul>
                            <li>âœ… æ”¯æŒæ ‡å‡† Markdown è¯­æ³•</li>
                            <li>âœ… ä»£ç é«˜äº®æ˜¾ç¤º</li>
                            <li>âœ… è¡¨æ ¼å’Œåˆ—è¡¨æ”¯æŒ</li>
                            <li>âœ… å›¾ç‰‡å’Œé“¾æ¥æ”¯æŒ</li>
                            <li>âœ… å“åº”å¼è®¾è®¡</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // é…ç½® marked é€‰é¡¹
        marked.setOptions({
            highlight: function(code, lang) {
                if (lang && Prism.languages[lang]) {
                    return Prism.highlight(code, Prism.languages[lang], lang);
                }
                return code;
            },
            breaks: true,
            gfm: true
        });

        // æ–‡ä»¶é€‰æ‹©å¤„ç†
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file && file.name.endsWith('.md') || file.name.endsWith('.markdown')) {
                loadMarkdownFile(file);
            } else {
                alert('è¯·é€‰æ‹© .md æˆ– .markdown æ–‡ä»¶');
            }
        });

        // åŠ è½½ Markdown æ–‡ä»¶
        function loadMarkdownFile(file) {
            const loading = document.getElementById('loading');
            const content = document.getElementById('markdownContent');
            const instructions = document.getElementById('instructions');
            
            loading.style.display = 'block';
            content.style.display = 'none';
            instructions.style.display = 'none';

            const reader = new FileReader();
            reader.onload = function(e) {
                const markdownText = e.target.result;
                renderMarkdown(markdownText, file.name);
                
                // ä¿å­˜åˆ°æœ€è¿‘æŸ¥çœ‹åˆ—è¡¨
                saveToRecent(file.name, markdownText);
                
                loading.style.display = 'none';
                content.style.display = 'block';
            };
            reader.readAsText(file, 'UTF-8');
        }

        // æ¸²æŸ“ Markdown
        function renderMarkdown(markdownText, filename) {
            // æå–æ ‡é¢˜
            const titleMatch = markdownText.match(/^# (.+)$/m);
            const title = titleMatch ? titleMatch[1] : filename.replace(/\.(md|markdown)$/, '');
            
            // æå–æ ‡ç­¾
            const tagsMatch = markdownText.match(/^tags?:\s*(.+)$/im);
            const tags = tagsMatch ? tagsMatch[1].split(',').map(tag => tag.trim()) : [];
            
            // æå–æ—¥æœŸ
            const dateMatch = markdownText.match(/^date:\s*(.+)$/im);
            const date = dateMatch ? dateMatch[1] : new Date().toISOString().split('T')[0];
            
            // æ¸²æŸ“æ ‡é¢˜
            document.getElementById('articleTitle').innerHTML = '<h1>' + title + '</h1>';
            
            // æ¸²æŸ“å…ƒä¿¡æ¯
            let metaHtml = '<div class="post-date">' + date + '</div>';
            if (tags.length > 0) {
                metaHtml += '<div class="tag-container">';
                tags.forEach(tag => {
                    metaHtml += '<span class="tag">' + tag + '</span>';
                });
                metaHtml += '</div>';
            }
            document.getElementById('articleMeta').innerHTML = metaHtml;
            
            // æ¸²æŸ“å†…å®¹
            const htmlContent = marked.parse(markdownText);
            document.getElementById('articleBody').innerHTML = htmlContent;
            
            // é«˜äº®ä»£ç å—
            if (window.Prism) {
                Prism.highlightAll();
            }
            
            // æ·»åŠ ä¿å­˜æŒ‰é’®
            addSaveButton(title, date, tags, markdownText);
        }

        // æ·»åŠ ä¿å­˜æŒ‰é’®
        function addSaveButton(title, date, tags, markdownText) {
            const saveButton = document.createElement('div');
            saveButton.innerHTML = `
                <div style="margin-top: 30px; text-align: center;">
                    <button onclick="saveAsBlogPost('${title}', '${date}', '${tags.join(',')}', \`${markdownText.replace(/`/g, '\\`')}\`)" 
                            style="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                        ğŸ’¾ ä¿å­˜ä¸ºåšå®¢æ–‡ç« 
                    </button>
                </div>
            `;
            document.getElementById('articleBody').appendChild(saveButton);
        }

        // ä¿å­˜ä¸ºåšå®¢æ–‡ç« 
        function saveAsBlogPost(title, date, tags, markdownText) {
            // è¿™é‡Œå¯ä»¥è°ƒç”¨ä¹‹å‰åˆ›å»ºçš„ Python è„šæœ¬
            alert('åŠŸèƒ½å¼€å‘ä¸­...\n\næ‚¨å¯ä»¥ï¼š\n1. å¤åˆ¶æ–‡ç« å†…å®¹\n2. ä½¿ç”¨ create_article_template.py è„šæœ¬\n3. æ‰‹åŠ¨åˆ›å»ºæ–‡ç« ');
        }

        // ä¿å­˜åˆ°æœ€è¿‘æŸ¥çœ‹
        function saveToRecent(filename, content) {
            let recent = JSON.parse(localStorage.getItem('recentArticles') || '[]');
            recent.unshift({
                name: filename,
                content: content.substring(0, 200) + '...',
                timestamp: new Date().toISOString()
            });
            recent = recent.slice(0, 5); // åªä¿ç•™æœ€è¿‘5ä¸ª
            localStorage.setItem('recentArticles', JSON.stringify(recent));
            updateRecentList();
        }

        // æ›´æ–°æœ€è¿‘æŸ¥çœ‹åˆ—è¡¨
        function updateRecentList() {
            const recent = JSON.parse(localStorage.getItem('recentArticles') || '[]');
            const container = document.getElementById('recentArticles');
            
            if (recent.length > 0) {
                document.getElementById('articleList').style.display = 'block';
                container.innerHTML = recent.map(article => 
                    `<div class="article-item" onclick="loadRecentArticle('${article.name}')">
                        <strong>${article.name}</strong><br>
                        <small>${article.content}</small>
                    </div>`
                ).join('');
            }
        }

        // åŠ è½½æœ€è¿‘æ–‡ç« 
        function loadRecentArticle(filename) {
            const recent = JSON.parse(localStorage.getItem('recentArticles') || '[]');
            const article = recent.find(a => a.name === filename);
            if (article) {
                // è¿™é‡Œéœ€è¦é‡æ–°è·å–å®Œæ•´å†…å®¹ï¼Œç®€åŒ–å¤„ç†
                alert('è¯·é‡æ–°é€‰æ‹©æ–‡ä»¶ä»¥æŸ¥çœ‹å®Œæ•´å†…å®¹');
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ›´æ–°æœ€è¿‘æŸ¥çœ‹åˆ—è¡¨
        window.onload = function() {
            updateRecentList();
        };
    </script>
</body>
</html>
